<!--
  Jarvis UI entrypoints:
  - /app ‚Üí app.html (main shell for both chat and admin)
  - /admin.html, /index.html ‚Üí redirects to /app
  All user and admin panels are rendered as views in this shell.
  Admin panels are only visible for admins (frontend-only, see app.js).
-->
<!doctype html>
<html lang="da">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Jarvis App</title>
    <link rel="icon" href="/ui/static/favicon.svg?v={{BUILD_ID}}" type="image/svg+xml" />
    <link rel="stylesheet" href="/ui/static/styles.css?v={{BUILD_ID}}" />
  </head>
<body class="app-shell">
  <div id="appRoot">
  <header class="topbar">
    <div class="topbar-left">
      <div class="brand">
        <h1 id="brandTop">Jarvis</h1>
        <span id="onlinePill" class="pill offline">Offline</span>
        <span id="statusBadge" class="pill">Klar</span>
        <span class="build-id">build:{{BUILD_ID}}</span>
      </div>
    </div>
    <div class="topbar-center">
      <div id="topBanner" class="top-banner" aria-live="polite">
        <div id="bannerTrack" class="banner-track"></div>
      </div>
      <div id="sessionExpiryBanner" class="session-expiry-banner hidden" aria-live="assertive" role="alert">
        <span id="sessionExpiryText">Session expired ‚Äì please log in again</span>
        <button id="sessionExpiryConfirmBtn" class="secondary">OK</button>
      </div>
      <div id="eventsList" class="events-list" aria-live="polite"></div>
    </div>
    <div class="topbar-right">
      <div class="top-controls">
        <input id="globalSearch" placeholder="S√∏g i docs, tickets, chats..." />
        <select id="langSelect" class="control-select" aria-label="Sprog">
          <option value="da">üá©üá∞ DK</option>
          <option value="en">üá¨üáß EN</option>
        </select>
        <select id="themeSelect" class="control-select" aria-label="Tema">
          <option value="dark">üåô M√∏rk</option>
          <option value="light">‚òÄ Lys</option>
          <option value="system">üíª System</option>
        </select>
        <select id="responseModeSelect" class="control-select" aria-label="Svar mode">
          <option value="normal">üìù Normal</option>
          <option value="short">üí¨ Kort</option>
          <option value="deep">üîç Dybt</option>
        </select>
        <select id="modelSelect" class="hidden"></select>
        <div id="notifWrap" class="notif-wrap hidden">
          <button id="notificationsBtn" class="control-btn" aria-label="Notifikationer">
            üîî
            <span id="notificationsBadge" class="notifications-badge hidden">0</span>
          </button>
          <div id="notificationsDropdown" class="notifications-dropdown hidden">
            <div class="notifications-header">
              <h3>Notifikationer</h3>
              <button id="notificationsMarkAllRead" class="notifications-mark-all">Mark√©r alle som l√¶st</button>
            </div>
            <div id="notificationsList" class="notifications-list">
              <div class="notifications-empty">Ingen notifikationer endnu.</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="shell app-main chat-layout">
    <aside class="sidebar" role="navigation" aria-label="Chats og navigation">
      <div class="sidebar-header">
        <div class="rail-logo">
          <span class="logo-short" id="brandShort">J</span>
          <span class="logo-long" id="brandCore">Jarvis</span>
          <span id="jarvisDot" class="jarvis-dot" title="Jarvis status"></span>
        </div>
        <div class="rail-row">
          <button id="collapseBtn" class="rail-btn" title="Skjul sidebar" aria-label="Skjul sidebar">‚â°</button>
          <button id="newChatBtn" class="rail-btn" title="Ny chat" aria-label="Ny chat">Ôºã</button>
          <button id="searchBtn" class="rail-btn" title="S√∏g" aria-label="S√∏g">üîç</button>
          <button id="uploadSidebarBtn" class="rail-btn" title="Upload" aria-label="Upload">‚§¥</button>
        </div>
      </div>
      <div class="sidebar-body">
        <div class="sidebar-panel">
          <div class="session-group-title">Dine chats</div>
          <input id="sessionSearch" placeholder="S√∏g chats..." />
          <button id="newChatInline" class="secondary">Start ny chat</button>
          <div id="expiryNotice" class="small"></div>
          <div class="sidebar-panel" id="notesPanel">
            <div class="session-group-title">Noter</div>
            <div id="notesList" class="mini-list"></div>
          </div>
          <nav class="session-scroll" aria-label="Tidligere chats">
            <div id="sessionList" class="session-list"></div>
            <div class="small" id="sessionStatus"></div>
          </nav>
        </div>
        <div class="sidebar-panel admin-only" id="adminNav">
          <div class="session-group-title">Admin</div>
          <ul class="nav-list">
            <li><a href="#admin/dashboard">Dashboard</a></li>
            <li><a href="#admin/users">Users</a></li>
            <li><a href="#admin/sessions">Sessions</a></li>
            <li><a href="#admin/tools">Tools</a></li>
            <li><a href="#admin/config">Config</a></li>
            <li><a href="#admin/logs">Logs</a></li>
            <li><a href="#admin/tickets">Tickets</a></li>
            <li><a href="#admin/jobs">Jobs</a></li>
          </ul>
        </div>
      </div>
      <div class="sidebar-footer">
        <button id="ticketsBtn" class="rail-btn rail-wide" title="Tickets" aria-label="Tickets">
          <span class="rail-icon">üßæ</span>
          <span class="rail-label">Tickets</span>
        </button>
        <button id="docsBtn" class="rail-btn rail-wide" title="Dokumentation" aria-label="Dokumentation">
          <span class="rail-icon">üìò</span>
          <span class="rail-label">Dokumentation</span>
        </button>
        <button id="accountBtn" class="rail-btn rail-wide" title="Min konto" aria-label="Min konto">
          <span class="rail-icon">üë§</span>
          <span class="rail-label">Min konto</span>
        </button>
        <button id="adminBtn" class="rail-btn rail-wide admin-only" title="Admin" aria-label="Admin">
          <span class="rail-icon">‚öô</span>
          <span class="rail-label">Admin settings</span>
        </button>
        <button id="logoutBtn" class="rail-btn rail-wide" title="Log ud" aria-label="Log ud">
          <span class="rail-icon">‚èª</span>
          <span class="rail-label">Log ud</span>
        </button>
      </div>
    </aside>

    <section class="chat-pane" role="main">
      <div class="main-column">
        <!-- Default chat layout; JS can swap panels, but IDs stay stable -->
        <section class="chat-feed conversation-log" aria-label="Chatbeskeder" aria-live="polite">
          <div id="emptyState" class="empty-state hidden">
            <h1>Velkommen til Jarvis</h1>
            <p>Start en ny samtale eller v√¶lg en tidligere chat i venstre side.</p>
          </div>
          <div id="chat" class="chat-feed-inner"></div>
          <div id="greetingBanner" class="greeting-banner"></div>
        </section>
        <!-- Tool-chips row: Streaming, Personality, Status -->
        <section class="status-row tool-chips-row" aria-label="V√¶rkt√∏jschips for samtale">
          <div class="chip-toggle" id="streamChip" tabindex="0" role="button" aria-pressed="false">
            <span id="streamDot" class="tool-dot"></span>
            <span>Streaming</span>
          </div>
          <div class="chip-toggle" id="personaChip" tabindex="0" role="button">
            <span>Personlighed</span>
          </div>
          <div class="chip-toggle status-chip" id="statusChip" tabindex="-1">
            <span id="statusChipText">Jarvis klar</span>
          </div>
        </section>
        <input type="checkbox" id="streamToggle" checked class="hidden" />
        <!-- Personality popover (hidden by default) -->
        <div id="personaPopover" class="popover hidden" role="dialog" aria-modal="true">
          <label for="personaInput">Personlighed/toning</label>
          <textarea id="personaInput" rows="2" placeholder="Skriv personlighed eller tone..."></textarea>
          <div class="popover-actions">
            <button id="personaSaveBtn" class="secondary">Gem</button>
            <button id="personaCancelBtn" class="secondary">Annull√©r</button>
          </div>
        </div>
        <div id="chatStatusInline" class="status-line">Jarvis  Klar.</div>
        <section class="composer-wrap" aria-label="Chat input">
          <div class="composer-input">
            <div class="tools-btn-wrap">
              <button id="toolsBtn" class="composer-btn" title="V√¶rkt√∏jer" aria-label="V√¶rkt√∏jer">+</button>
            </div>
            <textarea id="prompt" placeholder="Skriv en besked eller brug /kommando‚Ä¶" rows="1"></textarea>
            <button id="micBtn" class="composer-btn" title="Tale til Jarvis" aria-label="Tale til Jarvis">üé§</button>
            <button id="sendBtn" class="composer-btn send-btn" title="Send">‚Üë</button>
          </div>
          <div id="toolsDropdown" class="tools-dropdown hidden">
            <div class="tools-grid">
              <label><input type="checkbox" id="toolNews" checked /> Nyheder</label>
              <label><input type="checkbox" id="toolWeather" checked /> Vejr</label>
              <label><input type="checkbox" id="toolSearch" checked /> Web</label>
              <label><input type="checkbox" id="toolCurrency" checked /> Valuta</label>
              <label><input type="checkbox" id="toolImage" checked /> Billede</label>
              <label class="admin-only"><input type="checkbox" id="toolSystem" checked /> System</label>
              <label class="admin-only"><input type="checkbox" id="toolPing" checked /> Ping</label>
              <label class="admin-only"><input type="checkbox" id="toolProcess" checked /> Processer</label>
            </div>
          </div>
        </section>
      </div>
      <!-- Settings modal: 2-column layout -->
      <div id="settingsModal" class="modal hidden" aria-modal="true" role="dialog">
        <div class="modal__dialog">
          <button id="closeSettings" class="modal__close" aria-label="Luk indstillinger">‚úï</button>
          <nav class="modal__nav" aria-label="Indstillinger sektioner">
            <div class="session-group-title">Indstillinger</div>
            <ul class="nav-list">
              <li><a href="#settings/general">Generelt</a></li>
              <li><a href="#settings/notifications">Notifikationer</a></li>
              <li><a href="#settings/persona">Personlig tilpasning</a></li>
              <li><a href="#settings/apps">Apps</a></li>
              <li><a href="#settings/schedule">Tidsplaner</a></li>
              <li><a href="#settings/data">Datasikkerhed</a></li>
              <li><a href="#settings/account">Konto</a></li>
            </ul>
          </nav>
          <section class="modal__panel" id="settingsPanel">
            <h2>Indstillinger</h2>
            <p>V√¶lg en sektion i venstre menu.</p>
            <div class="settings-section" id="settingsAccount">
              <h3>Konto & kvota</h3>
              <div id="quotaBar" class="quota-bar">
                <div class="quota-label">
                  <span>Kvota</span>
                  <span id="quotaText">0/0 MB</span>
                </div>
                <div class="quota-track">
                  <div id="quotaFill" class="quota-fill"></div>
                </div>
              </div>
              <button id="quotaRequestBtn" class="secondary quota-btn">Anmod om mere plads</button>
            </div>
          </section>
        </div>
      </div>
      <div id="sessionPromptRow" class="session-prompt-row hidden">
        <span class="session-prompt-label">Session-personlighed</span>
        <input id="sessionPromptInput" placeholder="Skriv personlighed for denne chat..." />
        <button id="sessionPromptSave" class="secondary">Gem</button>
        <button id="sessionPromptClear" class="secondary">Nulstil</button>
      </div>
      <div id="suggestions" class="suggestions hidden"></div>
      <input id="uploadInput" type="file" class="hidden" />
      <input id="imageUploadInput" type="file" accept="image/*" class="hidden" />
      <!-- Dev: runtime info (populated from /v1/info) -->
      <div id="devInfo" class="dev-info hidden" aria-hidden="true">
        <span id="devInfoCompact" class="dev-info-compact"></span>
        <button id="devInfoToggle" class="dev-info-toggle" aria-expanded="false" aria-label="Toggle dev info">‚ãØ</button>
        <div id="devInfoFull" class="dev-info-full hidden" aria-hidden="true"></div>
      </div>
      <div class="small" id="chatStatus"></div>

    </section>

    <aside class="rightbar admin-only hidden" aria-label="Admin panel">
      <div class="panel right-panel no-border">
        <div class="panel-header">
          <div class="rightbar-row">
            <div>
              <span id="updatesClock" class="right-panel-clock"></span>
              <span class="right-panel-sep">¬∑</span>
              <span id="rightbarCity" class="right-panel-city"></span>
            </div>
            <button id="rightbarToggle" class="rail-btn" title="Skjul panel" aria-label="Skjul panel">‚á§</button>
          </div>
        </div>
      </div>
      <div class="panel right-panel">
        <div class="panel-header">
          <div class="right-panel-title">Seneste UI‚Äëopdateringer</div>
        </div>
        <div id="updatesPanel" class="panel-body right-panel-body"></div>
      </div>
      <div class="panel right-panel">
        <div class="panel-header">
          <div class="right-panel-title">Nye kommandoer</div>
        </div>
        <div id="commandsPanel" class="panel-body right-panel-body"></div>
      </div>
      <div class="panel right-panel admin-only">
        <div class="panel-header">
          <div class="right-panel-title">Admin</div>
        </div>
        <div id="adminViewHost" class="panel-body right-panel-body"></div>
      </div>
      <div class="panel right-panel admin-only" id="rightTicketsPanel">
        <div class="panel-header">
          <div class="right-panel-title" id="rightTicketsTitle">Tickets</div>
        </div>
        <div id="rightTicketsBody" class="panel-body right-panel-body"></div>
      </div>
      <div class="panel right-panel" id="rightNotesPanel">
        <div class="panel-header">
          <div class="right-panel-title">Noter</div>
        </div>
        <div id="rightNotesBody" class="panel-body right-panel-body"></div>
      </div>
      <div class="panel right-panel admin-only" id="statusPanelCard">
        <div class="panel-header">
          <div class="right-panel-title">Status / Logs</div>
        </div>
        <div id="statusPanel" class="panel-body right-panel-body"></div>
      </div>
    </aside>
  </main>
  <footer class="app-footer">
    <span id="footerText">Jarvis v.1 @ 2026</span>
    <span class="footer-links">
      <a id="footerSupport" href="#">Support</a>
      <a id="footerContact" href="#">Kontakt</a>
      <a id="footerLicense" href="#">Open‚Äësource licens</a>
    </span>
  </footer>
  <div id="cookieBanner" class="cookie-banner" style="display:none;">
    <div class="cookie-card">
      <div class="cookie-text">
        <strong>Cookies</strong><br />
        Vi bruger cookies til login og sikker session. I 24 timer gemmer vi din valgte indstilling.
        <br />
        <br />
        <strong>Minimum</strong>: kun login/session.
        <br />
        <strong>Fuld</strong>: sprog, tidszone og (valgfrit) by til vejret.
      </div>
      <div class="cookie-actions">
        <button id="cookieMinimal" class="secondary">Minimum</button>
        <button id="cookieAccept">Fuld</button>
      </div>
    </div>
  </div>
  <script src="/ui/static/authStore.js?v={{BUILD_ID}}"></script>
  <script src="/ui/static/auth.js?v={{BUILD_ID}}"></script>
  <script src="/ui/static/api.js?v={{BUILD_ID}}"></script>
  <script src="/ui/static/marked.min.js?v={{BUILD_ID}}"></script>
  <script>window.JARVIS_BUILD_ID="{{BUILD_ID}}";</script>
  <script type="module" src="/ui/static/main.js?v={{BUILD_ID}}"></script>
  </div>
  <div id="loggedOutScreen" class="logged-out hidden">
    <div class="logged-out-card">
      <h1>Log ind for at forts√¶tte</h1>
      <p>Din session er udl√∏bet eller du er ikke logget ind.</p>
      <button id="loggedOutLoginBtn">Log ind</button>
    </div>
  </div>
</body>
</html>
